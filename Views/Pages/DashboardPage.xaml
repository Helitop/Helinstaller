<Page
    x:Class="Helinstaller.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d" Margin="0,0,0,0" Loaded="Page_Loaded" 
    Title="Dashboard"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}">

    <Page.Resources>
        <Storyboard x:Key="ShowEditTip">
            <DoubleAnimation
            Storyboard.TargetName="editTip"
            Storyboard.TargetProperty="Opacity"
            To="0.3"
            Duration="0:0:0.2" />
            <DoubleAnimation
            Storyboard.TargetName="editTip"
            Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
            To="0"
            Duration="0:0:0.2" />
        </Storyboard>

        <Storyboard x:Key="HideEditTip">
            <DoubleAnimation
            Storyboard.TargetName="editTip"
            Storyboard.TargetProperty="Opacity"
            To="0"
            Duration="0:0:0.2" />
            <DoubleAnimation
            Storyboard.TargetName="editTip"
            Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
            To="5" 
            Duration="0:0:0.2" />
        </Storyboard>
        <Storyboard x:Key="ShakeAnimation" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                From="-2" To="2" Duration="0:0:0.1" />
        </Storyboard>

        <Storyboard x:Key="SlideDownAnimation">
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="EditModePanel" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Static Visibility.Visible}"/>
            </ObjectAnimationUsingKeyFrames>

            <DoubleAnimation Storyboard.TargetName="EditModePanel"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="-40" To="0" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="5"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <DoubleAnimation Storyboard.TargetName="AppsScrollViewer"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="0" To="40" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="5"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <DoubleAnimation Storyboard.TargetName="EditModePanel"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>

        <Storyboard x:Key="SlideUpAnimation">
            <DoubleAnimation Storyboard.TargetName="EditModePanel"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             To="-80" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseIn" Exponent="5"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <DoubleAnimation Storyboard.TargetName="AppsScrollViewer"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseIn" Exponent="5"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <DoubleAnimation Storyboard.TargetName="EditModePanel"
                             Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:0.2"/>

            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="EditModePanel" Storyboard.TargetProperty="Visibility" BeginTime="0:0:0.3">
                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Static Visibility.Collapsed}"/>
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="FadeInLoading">
            <DoubleAnimation
        Storyboard.TargetName="LoadingOverlay"
        Storyboard.TargetProperty="Opacity"
        From="0" To="1" 
        Duration="0:0:0.05" />
        </Storyboard>
        <Storyboard x:Key="FadeOutLoading">
            <DoubleAnimation
        Storyboard.TargetName="AppsGrid"
        Storyboard.TargetProperty="Opacity"
        From="1" To="0" 
        Duration="0:0:0.05" />
        </Storyboard>

    </Page.Resources>
    <Grid>
        <Grid x:Name="AppsGrid"
          Background="Transparent" 
          MouseLeftButtonDown="Grid_MouseLeftButtonDown"
          AllowDrop="True"
          PreviewDragOver="Grid_PreviewDragOver">
            <ScrollViewer x:Name="AppsScrollViewer"
                      Panel.ZIndex="0"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">

                <ScrollViewer.RenderTransform>
                    <TranslateTransform Y="0"/>
                </ScrollViewer.RenderTransform>

                <WrapPanel
                x:Name="AppsWrapPanel"
                Margin="10"
                HorizontalAlignment="Center"
                VerticalAlignment="Stretch"
                Orientation="Horizontal" />
            </ScrollViewer>
            
            <StackPanel x:Name="EditModePanel" 
                    Panel.ZIndex="1"
                    Orientation="Horizontal" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Top"
                    Margin="0,0,0,0"
                    Visibility="Collapsed" Opacity="0">

                <StackPanel.RenderTransform>
                    <TranslateTransform Y="-80"/>
                </StackPanel.RenderTransform>

                <ui:Button Content="Завершить редактирование" 
                       Icon="{ui:SymbolIcon Symbol=Checkmark24}" 
                       Appearance="Primary"
                       Click="ConfirmChanges_Click" 
                       Height="45"
                       FontSize="14">
                    <ui:Button.Effect>
                        <DropShadowEffect BlurRadius="15" ShadowDepth="5" Opacity="0.3" Direction="270"/>
                    </ui:Button.Effect>
                </ui:Button>
            </StackPanel>
            <StackPanel x:Name="editTip"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,10"
                    Opacity="0">
                <StackPanel.RenderTransform>
                    <TranslateTransform Y="5"/>
                </StackPanel.RenderTransform>
                <ui:SymbolIcon Symbol="Info24" Margin="0,0,5,0"/>
                <ui:TextBlock VerticalAlignment="Bottom" HorizontalAlignment="Center" Text="Нажмите правую кнопку мыши для изменения"/>
            </StackPanel>
        </Grid>
        <Grid x:Name="LoadingOverlay"
        
Visibility="Collapsed"
Panel.ZIndex="100"
        Opacity="0" >
            <ui:ProgressRing IsIndeterminate="True" 
                   Width="60" 
                   Height="60" 
                   Margin="0,0,0,0"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>

        </Grid>
    </Grid>
</Page>